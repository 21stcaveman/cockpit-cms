(function(t,e,i){var n=function(t,i){var s=e(t);s.data("markdownarea")||(this.element=s,this.options=e.extend({},n.defaults,i),this.init(),this.element.data("markdownarea",this))};e.extend(n.prototype,{init:function(){var t=this,s=n.template;s=s.replace(/\{\:lblPreview\}/g,this.options.lblPreview),s=s.replace(/\{\:lblCodeview\}/g,this.options.lblCodeview),this.markdownarea=e(s),this.container=this.markdownarea.find(".uk-markdownarea-container"),this.toolbar=this.markdownarea.find(".uk-markdownarea-toolbar"),this.preview=this.markdownarea.find(".uk-markdownarea-preview"),this.code=this.markdownarea.find(".uk-markdownarea-code"),this.element.before(this.markdownarea).appendTo(this.code),this.editor=CodeMirror.fromTextArea(this.element[0],this.options.codemirror),this.editor.on("change",function(){var e=function(){var e=t.editor.getValue();marked(e,function(i,n){if(i)throw i;t.preview.html(n),t.element.val(e).trigger("update",[t])})};return e(),e}()),this._buildtoolbar(),this.fit(),e(window).on("resize",i.Utils.debounce(function(){t.fit()},200));var o=this.code.find(".CodeMirror-sizer"),a=this.preview.parent(),r=this.code.find(".CodeMirror-scroll").on("scroll",i.Utils.debounce(function(){if("tab"!=t.markdownarea.attr("data-mode")){var e=o.height()-r.height(),i=t.preview.height()-a.height(),n=i/e,s=r.scrollTop()*n;a.scrollTop(s)}},10));this.markdownarea.on("click",".uk-markdownarea-codetab, .uk-markdownarea-previewtab",function(){"tab"==t.markdownarea.attr("data-mode")&&(t.activetab="code"==t.activetab?"preview":"code",t.markdownarea.attr("data-active-tab",t.activetab))}),this.preview.parent().css("height",this.code.outerHeight())},_buildtoolbar:function(){if(this.options.toolbar&&this.options.toolbar.length){var t=this,i=[];this.options.toolbar.forEach(function(e){if(n.commands[e]){var s=n.commands[e].title?n.commands[e].title:e;i.push('<a data-cmd="'+e+'" title="'+s+'" data-uk-tooltip>'+n.commands[e].label+"</a>"),n.commands[e].shortcut&&t.registerShortcut(n.commands[e].shortcut,n.commands[e].action)}}),this.toolbar.html(i.join("\n")).on("click","a[data-cmd]",function(){var i=e(this).data("cmd");i&&n.commands[i]&&n.commands[i].action.apply(t,[t.editor])})}},fit:function(){var t=this.options.mode;"split"==t&&this.markdownarea.width()<this.options.maxsplitsize&&(t="tab"),"tab"==t&&(this.activetab||(this.activetab="code",this.markdownarea.attr("data-active-tab",this.activetab))),this.markdownarea.attr("data-mode",t)},registerShortcut:function(t,i){var n=this;t=e.isArray(t)?t:[t];for(var s=0,o=t.length;o>s;s++){var a={};a[t[s]]=function(){i.apply(n,[n.editor])},n.editor.addKeyMap(a)}}}),e.fn.markdownarea=function(t){return this.each(function(){var i=e(this);i.data("markdownarea")||new n(i,t)})};var s=function(t,e){var i=e.getSelection(),n=t.replace("$1",i);e.replaceSelection(n,"end")};n.commands={bold:{title:"Bold",label:'<i class="uk-icon-bold"></i>',shortcut:["Ctrl-B","Cmd-B"],action:function(t){s("**$1**",t)}},italic:{title:"Italic",label:'<i class="uk-icon-italic"></i>',action:function(t){s("*$1*",t)}},strike:{title:"Strikethrough",label:'<i class="uk-icon-strikethrough"></i>',action:function(t){s("~~$1~~",t)}},blockquote:{title:"Blockquote",label:'<i class="uk-icon-quote-right"></i>',action:function(t){s("> $1",t)}},link:{title:"Link",label:'<i class="uk-icon-link"></i>',action:function(t){s("[$1](http://)",t)}},picture:{title:"Picture",label:'<i class="uk-icon-picture"></i>',action:function(t){s("![$1](http://)",t)}},listUl:{title:"Unordered List",label:'<i class="uk-icon-list-ul"></i>',action:function(t){s("* $1",t)}},listOl:{title:"Ordered List",label:'<i class="uk-icon-list-ol"></i>',action:function(t){s("1. $1",t)}}},n.defaults={mode:"split",maxsplitsize:1e3,codemirror:{mode:"gfm",tabMode:"indent",tabindex:"2",lineWrapping:!0,dragDrop:!1},toolbar:["bold","italic","strike","link","picture","blockquote","listUl","listOl"],lblPreview:"Preview",lblCodeview:"Markdown"},n.template='<div class="uk-markdownarea"><div class="uk-markdownarea-tabs uk-clearfix"><div class="uk-markdownarea-toolbar"></div><div class="uk-markdownarea-previewtab"><i class="uk-icon-eye-open"></i><span class="uk-hidden-small"> {:lblPreview}</span></div><div class="uk-markdownarea-codetab"><i class="uk-icon-code"></i><span class="uk-hidden-small"> {:lblCodeview}</span></div></div><div class="uk-markdownarea-container"><div><div class="uk-markdownarea-code"></div></div><div style=""><div class="uk-markdownarea-preview"></div></div></div></div>',i.markdownarea=n,e(function(){marked.setOptions({gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,langPrefix:"lang-"}),e("textarea[data-uk-markdownarea]").each(function(){var t,s=e(this);s.data("markdownarea")||(t=new n(s,i.Utils.options(s.attr("data-uk-markdownarea"))))})})})(window,jQuery,jQuery.UIkit);