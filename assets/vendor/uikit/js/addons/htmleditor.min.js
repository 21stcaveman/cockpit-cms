/*! UIkit 2.6.0 | http://www.getuikit.com | (c) 2014 YOOtheme | MIT License */

!function(a){"function"==typeof define&&define.amd&&define("uikit-htmleditor",["uikit"],function(){return jQuery.UIkit.htmleditor||a(window,window.jQuery,window.jQuery.UIkit)}),window&&window.jQuery&&window.jQuery.UIkit&&a(window,window.jQuery,window.jQuery.UIkit)}(function(a,b,c){var d=function(a,c){var e=b(a);e.data("htmleditor")||(this.element=e,this.options=b.extend(!0,{},d.defaults,c),this.CodeMirror=this.options.CodeMirror||CodeMirror,this.buttons={},this.plugins=[],this._init(),this.element.data("htmleditor",this))};return b.extend(d.prototype,{_init:function(){var a=this,e=d.template;e=e.replace(/\{:lblPreview\}/g,this.options.lblPreview),e=e.replace(/\{:lblCodeview\}/g,this.options.lblCodeview),this.htmleditor=b(e),this.content=this.htmleditor.find(".uk-htmleditor-content"),this.toolbar=this.htmleditor.find(".uk-htmleditor-toolbar"),this.preview=this.htmleditor.find(".uk-htmleditor-preview").children().eq(0),this.code=this.htmleditor.find(".uk-htmleditor-code"),this.element.before(this.htmleditor).appendTo(this.code),this.editor=this.CodeMirror.fromTextArea(this.element[0],this.options.codemirror),this.editor.htmleditor=this,this.editor.on("change",c.Utils.debounce(function(){a.render()},150)),this.editor.on("change",function(){a.editor.save()}),this.code.find(".CodeMirror").css("height",this.options.height),b(window).on("resize",c.Utils.debounce(function(){a.fit()},200));var f=a.preview.parent(),g=this.code.find(".CodeMirror-sizer"),h=this.code.find(".CodeMirror-scroll").on("scroll",c.Utils.debounce(function(){if("tab"!=a.htmleditor.attr("data-mode")){var b=g.height()-h.height(),c=f[0].scrollHeight-f.height(),d=c/b,e=h.scrollTop()*d;f.scrollTop(e)}},10));this.htmleditor.on("click",".uk-htmleditor-button-code, .uk-htmleditor-button-preview",function(c){c.preventDefault(),"tab"==a.htmleditor.attr("data-mode")&&(a.htmleditor.find(".uk-htmleditor-button-code, .uk-htmleditor-button-preview").removeClass("uk-active").filter(this).addClass("uk-active"),a.activetab=b(this).hasClass("uk-htmleditor-button-code")?"code":"preview",a.htmleditor.attr("data-active-tab",a.activetab),a.editor.refresh())}),this.htmleditor.on("click","a[data-htmleditor-button]",function(){a.activetab&&"code"!=a.activetab||a.element.trigger("action."+b(this).data("htmleditor-button"),[a.editor])}),this.preview.parent().css("height",this.code.height()),this.options.autocomplete&&this.CodeMirror.showHint&&this.CodeMirror.hint&&this.CodeMirror.hint.html&&this.editor.on("inputRead",c.Utils.debounce(function(){var b=a.editor.getDoc(),c=b.getCursor(),d=a.CodeMirror.innerMode(a.editor.getMode(),a.editor.getTokenAt(c).state).mode.name;if("xml"==d){var e=a.editor.getCursor(),f=a.editor.getTokenAt(e);("<"==f.string.charAt(0)||"attribute"==f.type)&&a.CodeMirror.showHint(a.editor,a.CodeMirror.hint.html,{completeSingle:!1})}},100)),this.debouncedRedraw=c.Utils.debounce(function(){a.redraw()},5),b(d.plugins).on("add",function(){a.initPlugins()}),this.initPlugins(),this.redraw()},addButton:function(a,b){this.buttons[a]=b},addButtons:function(a){b.extend(this.buttons,a)},initPlugins:function(){for(var a=this.options.plugins.length?this.options.plugins:Object.keys(d.plugins),b=0;b<a.length;b++)this.addPlugin(a[b])},addPlugin:function(a){d.plugins[a]&&-1==b.inArray(a,this.plugins)&&(d.plugins[a](this),this.plugins.push(a),this.debouncedRedraw())},replaceInPreview:function(a,b){function c(a){var b=d.getValue().substring(0,a).split("\n");return{line:b.length-1,ch:b[b.length-1].length}}var d=this.editor,e=[],f=d.getValue(),g=-1;return this.currentvalue=this.currentvalue.replace(a,function(){g=f.indexOf(arguments[0],++g);var a={matches:arguments,from:c(g),to:c(g+arguments[0].length),replace:function(b){d.replaceRange(b,a.from,a.to)},inRange:function(b){return b.line===a.from.line&&b.line===a.to.line?b.ch>=a.from.ch&&b.ch<a.to.ch:b.line===a.from.line&&b.ch>=a.from.ch||b.line>a.from.line&&b.line<a.to.line||b.line===a.to.line&&b.ch<a.to.ch}},h=b(a);return 0==h?arguments[0]:(e.push(a),h)}),e},_buildtoolbar:function(){if(this.options.toolbar&&this.options.toolbar.length){var a=this,b=[];this.toolbar.empty(),this.options.toolbar.forEach(function(c){if(a.buttons[c]){var d=a.buttons[c].title?a.buttons[c].title:c;b.push('<li><a data-htmleditor-button="'+c+'" title="'+d+'" data-uk-tooltip>'+a.buttons[c].label+"</a></li>")}}),this.toolbar.html(b.join("\n"))}},fit:function(){var a=this.options.mode;"split"==a&&this.htmleditor.width()<this.options.maxsplitsize&&(a="tab"),"tab"==a&&(this.activetab||(this.activetab="code",this.htmleditor.attr("data-active-tab",this.activetab)),this.htmleditor.find(".uk-htmleditor-button-code, .uk-htmleditor-button-preview").removeClass("uk-active").filter("code"==this.activetab?".uk-htmleditor-button-code":".uk-htmleditor-button-preview").addClass("uk-active")),this.editor.refresh(),this.preview.parent().css("height",this.code.height()),this.htmleditor.attr("data-mode",a)},redraw:function(){this._buildtoolbar(),this.render(),this.fit()},getMode:function(){return this.editor.getOption("mode")},getCursorMode:function(){var a={mode:"html"};return this.element.trigger("cursorMode",[a]),a.mode},render:function(){return this.currentvalue=this.editor.getValue(),this.currentvalue?(this.element.trigger("render",[this]),this.element.trigger("renderLate",[this]),void this.preview.html(this.currentvalue)):(this.element.val(""),void this.preview.html(""))},addShortcut:function(a,c){var d={};return b.isArray(a)||(a=[a]),a.forEach(function(a){d[a]=c}),this.editor.addKeyMap(d),d},addShortcutAction:function(a,b){var c=this;this.addShortcut(b,function(){c.element.trigger("action."+a,[c.editor])})},replaceSelection:function(a){var b=this.editor.getSelection();if(!b.length){for(var c=this.editor.getCursor(),d=this.editor.getLine(c.line),e=c.ch,f=e;f<d.length&&/[\w$]+/.test(d.charAt(f));)++f;for(;e&&/[\w$]+/.test(d.charAt(e-1));)--e;var g=e!=f&&d.slice(e,f);g&&(this.editor.setSelection({line:c.line,ch:e},{line:c.line,ch:f}),b=g)}var h=a.replace("$1",b);this.editor.replaceSelection(h,"end"),this.editor.focus()},replaceLine:function(a){var b=this.editor.getDoc().getCursor(),c=this.editor.getLine(b.line),d=a.replace("$1",c);this.editor.replaceRange(d,{line:b.line,ch:0},{line:b.line,ch:c.length}),this.editor.setCursor({line:b.line,ch:d.length}),this.editor.focus()},save:function(){this.editor.save()}}),d.defaults={mode:"split",markdown:!1,autocomplete:!0,height:500,plugins:[],maxsplitsize:1e3,markedOptions:{gfm:!0,tables:!0,breaks:!0,pedantic:!0,sanitize:!1,smartLists:!0,smartypants:!1,langPrefix:"lang-"},codemirror:{mode:"htmlmixed",tabMode:"indent",tabsize:4,lineWrapping:!0,dragDrop:!1,autoCloseTags:!0,matchTags:!0,autoCloseBrackets:!0,matchBrackets:!0,indentUnit:4},toolbar:["bold","italic","strike","link","picture","blockquote","listUl","listOl"],lblPreview:"Preview",lblCodeview:"HTML",lblMarkedview:"Markdown"},d.template='<div class="uk-htmleditor uk-clearfix" data-mode="split"><div class="uk-htmleditor-navbar"><ul class="uk-htmleditor-navbar-nav uk-htmleditor-toolbar"></ul><div class="uk-htmleditor-navbar-flip"><ul class="uk-htmleditor-navbar-nav"><li class="uk-htmleditor-button-code"><a>{:lblCodeview}</a></li><li class="uk-htmleditor-button-preview"><a>{:lblPreview}</a></li><li><a data-htmleditor-button="fullscreen"><i class="uk-icon-expand"></i></a></li></ul></div></div><div class="uk-htmleditor-content"><div class="uk-htmleditor-code"></div><div class="uk-htmleditor-preview"><div></div></div></div></div>',d.plugins={},d.addPlugin=function(a,c){d.plugins[a]=c,b(d.plugins).trigger("add",[a])},c.htmleditor=d,b(function(){b("textarea[data-uk-htmleditor]").each(function(){var a,e=b(this);e.data("htmleditor")||(a=new d(e,c.Utils.options(e.attr("data-uk-htmleditor"))))})}),d.addPlugin("base",function(a){function b(b,c,d){a.element.on("action."+b,function(){"html"==a.getCursorMode()&&a["replaceLine"==d?"replaceLine":"replaceSelection"](c)})}a.addButtons({fullscreen:{title:"Fullscreen",label:'<i class="uk-icon-expand"></i>'},bold:{title:"Bold",label:'<i class="uk-icon-bold"></i>'},italic:{title:"Italic",label:'<i class="uk-icon-italic"></i>'},strike:{title:"Strikethrough",label:'<i class="uk-icon-strikethrough"></i>'},blockquote:{title:"Blockquote",label:'<i class="uk-icon-quote-right"></i>'},link:{title:"Link",label:'<i class="uk-icon-link"></i>'},picture:{title:"Picture",label:'<i class="uk-icon-picture-o"></i>'},listUl:{title:"Unordered List",label:'<i class="uk-icon-list-ul"></i>'},listOl:{title:"Ordered List",label:'<i class="uk-icon-list-ol"></i>'}}),b("bold","<strong>$1</strong>"),b("italic","<em>$1</em>"),b("strike","<del>$1</del>"),b("blockquote","<blockquote><p>$1</p></blockquote>","replaceLine"),b("link",'<a href="http://">$1</a>'),b("picture",'<img src="http://" alt="$1">'),b("listUl","<li>$1</li>","replaceLine"),b("listOl","<li>$1</li>","replaceLine"),a.htmleditor.on("click",'a[data-htmleditor-button="fullscreen"]',function(){a.htmleditor.toggleClass("uk-htmleditor-fullscreen");var b=a.editor.getWrapperElement();if(a.htmleditor.hasClass("uk-htmleditor-fullscreen"))a.editor.state.fullScreenRestore={scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,width:b.style.width,height:b.style.height},b.style.width="",b.style.height=a.content.height()+"px",document.documentElement.style.overflow="hidden";else{document.documentElement.style.overflow="";var c=a.editor.state.fullScreenRestore;b.style.width=c.width,b.style.height=c.height,window.scrollTo(c.scrollLeft,c.scrollTop)}setTimeout(function(){a.fit()},10)}),a.addShortcut(["Ctrl-S","Cmd-S"],function(){a.element.trigger("htmleditor-save",[a])}),a.addShortcutAction("bold",["Ctrl-B","Cmd-B"])}),d.addPlugin("markdown",function(a){function c(){a.editor.setOption("mode","gfm"),a.htmleditor.find(".uk-htmleditor-button-code a").html(a.options.lblMarkedview)}function d(b,c,d){a.element.on("action."+b,function(){"markdown"==a.getCursorMode()&&a["replaceLine"==d?"replaceLine":"replaceSelection"](c)})}var e=a.options.marked||marked;e&&(e.setOptions(a.options.markedOptions),a.options.markdown&&c(),d("bold","**$1**"),d("italic","*$1*"),d("strike","~~$1~~"),d("blockquote","> $1","replaceLine"),d("link","[$1](http://)"),d("picture","![$1](http://)"),d("listUl","* $1","replaceLine"),d("listOl","* $1","replaceLine"),a.element.on("renderLate",function(){"gfm"==a.editor.options.mode&&(a.currentvalue=e(a.currentvalue))}),a.element.on("cursorMode",function(b,c){if("gfm"==a.editor.options.mode){var d=a.editor.getDoc().getCursor();a.editor.getTokenAt(d).state.base.htmlState||(c.mode="markdown")}}),b.extend(a,{enableMarkdown:function(){c(),this.render()},disableMarkdown:function(){this.editor.setOption("mode","htmlmixed"),this.htmleditor.find(".uk-htmleditor-button-code a").html(this.options.lblCodeview),this.render()}}),a.element.on({enableMarkdown:function(){a.enableMarkdown()},disableMarkdown:function(){a.disableMarkdown()}}))}),d});